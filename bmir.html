<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="favicon.ico">
<link rel="manifest" href="manifest.json">
<title>BMI Calculator</title>

<style>

:root {
  --background-color: #f2f2f2;
  --foreground-color: black;
  --input-background-color: white;
  --input-foreground-color: black;
  --card-background-color: white;
  --range-background-color: #eef;
  --range-foreground-color: black;
  --result-background-color: #eef;
  --result-foreground-color: black;
  --error-color: #900;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background-color: #1d1d20;
    --foreground-color: #f2f2f2;
    --input-background-color: #4d4d50;
    --input-foreground-color: #f2f2f2;
    --card-background-color: #2d2d30;
    --range-background-color: #3d3d40;
    --range-foreground-color: #f2f2f2;
    --result-background-color: #eef;
    --result-foreground-color: black;
    --error-color: #f55;
  }
}

body {
  font-family: system-ui, sans-serif;
  background: var(--background-color);
  color: var(--foreground-color);
  padding: clamp(1rem, 4vw, 2rem);
}

input, select {
  background: var(--input-background-color);
  color: var(--input-foreground-color);
}

.card {
  max-width: 480px;
  margin: auto;
  background: var(--card-background-color);
  color: var(--foreground-color);
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.1);
}

.field {
  display: grid;
  grid-template-rows: auto auto;
  margin-top: 1rem;
  min-height: 44px;
}

.field label {
  margin-bottom: 0.25rem;
  font-weight: 500;
}

.field input,
.field select {
  box-sizing: border-box;
  width: 100%;
}

.range {
  margin-top: 1.5rem;
  background: var(--range-background-color);
  color: var(--range-foreground-color);
  padding: 1rem;
  border-radius: 6px;
}

.range-grid {
  display: grid;
  grid-template-columns: 1fr auto;
  row-gap: 0.5rem;
  column-gap: 1rem;
  align-items: baseline;
}

/* labels */
.range-grid > div:nth-child(odd) {
  font-weight: 500;
}

/* and their values */
.range-grid > div:nth-child(even) {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

.result {
  margin-top: 1.5rem;
  background: var(--result-background-color);
  color: var(--result-foreground-color);
  padding: 1rem;
  border-radius: 6px;
}

.result.underweight {
  background: hsl(210 100% 75%);
}

.result.normalweight {
  background: hsl(120 100% 75%);
}

.result.overweight {
  background: hsl(30 100% 75%);
}

.result.obese {
  background: hsl(0 100% 75%);
}

.result-grid {
  display: grid;
  grid-template-columns: 1fr auto;
  row-gap: 0.5rem;
  column-gap: 1rem;
  align-items: baseline;
}

/* labels */
.result-grid > div:nth-child(odd) {
  font-weight: 500;
}

/* and their values */
.result-grid > div:nth-child(even) {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

.error {
  margin-top: 1rem;
  color: var(--error-color);
}
</style>
</head>

<body>

<div class="card">
<h1>BMI Calculator</h1>

<div class="field">
<label for="sex">Sex</label>
<select id="sex">
  <option value="male">Male</option>
  <option value="female">Female</option>
</select>
</div>

<div class="field">
<label for="age">Age</label>
<input type="number" id="age" min="0">
</div>

<div class="field">
<label for="height">Height (cm)</label>
<input type="number" id="height" min="0">
</div>

<div class="field">
<label for="weight">Weight (kg)</label>
<input type="number" id="weight" min="0">
</div>

<div class="field">
<label for="activity">Activity level</label>
<select id="activity">
  <option value="1.2">Sedentary</option>
  <option value="1.375">Light exercise</option>
  <option value="1.55">Moderate exercise</option>
  <option value="1.725">Heavy exercise</option>
  <option value="1.9">Athlete</option>
</select>
</div>

<div id="error" class="error">Please enable javascript.</div>

<div id="result" class="result" hidden>
  <div class="result-grid">
    <div>BMI</div>
    <div id="bmi-value"></div>

    <div>BMR</div>
    <div id="bmr-value"></div>

    <div>TDEE</div>
    <div id="tdee-value"></div>
  </div>
</div>

<div id="range" class="range" hidden>
  <div class="range-grid">
    <div>Healthy weight range</div>
    <div id="healthy-range"></div>

    <div>Reference (midpoint)</div>
    <div id="reference-weight"></div>
  </div>
</div>
</div>

<script>
const fields = ["sex", "age", "height", "weight", "activity"];

/* ---------------- persistence ---------------- */

function save() {
  const data = {};
  fields.forEach(id => data[id] = document.getElementById(id).value);
  localStorage.setItem("bmiApp", JSON.stringify(data));
}

function load() {
  const data = JSON.parse(localStorage.getItem("bmiApp"));
  if (!data) return;
  fields.forEach(id => {
    if (data[id] !== undefined) {
      document.getElementById(id).value = data[id];
    }
  });
}

/* ---------------- math ---------------- */

function calculateBMI(weightKg, heightCm) {
  const h = heightCm / 100;
  return weightKg / (h * h);
}

function bmiCategory(bmi) {
  if (bmi < 18.5) return "Underweight";
  if (bmi < 25)   return "Normal weight";
  if (bmi < 30)   return "Overweight";
  return "Obese";
}

function bmiClassname(bmi) {
  if (bmi < 18.5) return "underweight";
  if (bmi < 25)   return "normalweight";
  if (bmi < 30)   return "overweight";
  return "obese";
}

function calculateBMR(weightKg, heightCm, age, sex) {
  let bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age);
  return sex === "male" ? bmr + 5 : bmr - 161;
}

function calculateHealthyRange(heightCm) {
  let h = heightCm / 100;

  return {
    min: (h * h * 18.5),
    mid: (h * h * 21.75),
    max: (h * h * 25)
  };
}

/* ---------------- main logic ---------------- */

function recalculate() {
  const sex = document.getElementById("sex").value;
  const age = Number(document.getElementById("age").value);
  let height = Number(document.getElementById("height").value);
  let weight = Number(document.getElementById("weight").value);
  const activity = Number(document.getElementById("activity").value);

  const error = document.getElementById("error");
  const result = document.getElementById("result");

  error.textContent = "";
  range.hidden = true;
  result.className = "result"; // Restore default state.
  result.hidden = true;

  // validation without alerts
  if (age <= 0 || height <= 0 || weight <= 0) {
    error.textContent = "Please enter positive values for age, height and weight.";
    return;
  }

  // Range/midpoint
  const healthyRange = calculateHealthyRange(height);

  document.getElementById("healthy-range").textContent =
    healthyRange.min.toFixed(1) + " - " + healthyRange.max.toFixed(1) + " kg";
  document.getElementById("reference-weight").textContent =
    healthyRange.mid.toFixed(1) + " kg";
  range.hidden = false;

  // BMI/BMR and TDEE
  const bmi = calculateBMI(weight, height);
  const bmr = calculateBMR(weight, height, age, sex);
  const tdee = bmr * activity;

  document.getElementById("bmi-value").textContent  = bmi.toFixed(1)
    + " (" + bmiCategory(bmi) + ")";
  document.getElementById("bmr-value").textContent  = Math.round(bmr)
    + " kcal/day";
  document.getElementById("tdee-value").textContent = Math.round(tdee)
    + " kcal/day";

  result.classList.add(bmiClassname(bmi));
  result.hidden = false;

  save();
}

/* ---------------- wiring ---------------- */

// live recalculation: every change triggers recompute
fields.forEach(id => {
  document.getElementById(id).addEventListener("input", recalculate);
  document.getElementById(id).addEventListener("change", recalculate);
});

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

load();
recalculate();
</script>

</body>
</html>

